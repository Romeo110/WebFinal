<!DOCTYPE html>
<html lang="en">
<head>
  <meta charset="UTF-8">
  <meta name="viewport" content="width=device-width, initial-scale=1.0">
  <title>FilmFinder - Movies</title>
  <link rel="stylesheet" href="styles.css">
</head>
<body>
  <header>
    <h1>FilmFinder</h1>
    <nav>
      <ul>
        <li><a href="index.html">Home</a></li>
        <li><a href="#">Comparison</a></li>
        <li><a href="recommend.php">Recommendations</a></li>
        <li><a href="movies.html">Movies</a></li>
        <li><a href="#">Profile</a></li>
      </ul>
    </nav>
  </header>

  <main>
    <section id="search-filter">
      <input type="text" id="search" placeholder="Search for a movie...">
      <select id="search-type">
        <option value="title">Movie Title</option>
        <option value="genre">Genre</option>
        <option value="year">Release Year</option>
        <!-- Add more search options as needed -->
      </select>
      <button onclick="searchMovies()">Search</button>
    </section>

    <section id="search-results">
      <!-- This is where the search results will be displayed -->
    </section>

    <section id="random-movies">
      <!-- This is where the random movies will be displayed -->
    </section>
  </main>

  <footer>
    <p>&copy; 2024 FilmFinder. All rights reserved.</p>
  </footer>

  <script>
    // Fetch genre IDs
    function fetchGenreIds() {
      var apiKey = 'd5697eb16a89b204a004af1f8fea130c';

      fetch(`https://api.themoviedb.org/3/genre/movie/list?api_key=${apiKey}&language=en-US`)
        .then(response => response.json())
        .then(data => {
          var genres = data.genres;
          var genreMap = {};
          genres.forEach(genre => {
            genreMap[genre.name.toLowerCase()] = genre.id;
          });
          localStorage.setItem('genreMap', JSON.stringify(genreMap)); // Store genre map in localStorage
        })
        .catch(error => {
          console.error('Error fetching genre data:', error);
        });
    }

    // Fetch random movies
    function fetchRandomMovies() {
      var apiKey = 'd5697eb16a89b204a004af1f8fea130c';
      var randomMoviesUrl = `https://api.themoviedb.org/3/discover/movie?api_key=${apiKey}&sort_by=popularity.desc`;

      fetch(randomMoviesUrl)
        .then(response => response.json())
        .then(data => {
          if (data.results.length > 0) {
            displayRandomMovies(data.results);
          } else {
            console.error('No random movies found.');
          }
        })
        .catch(error => {
          console.error('Error fetching random movies:', error);
        });
    }

    // Display random movies
    function displayRandomMovies(movies) {
      var randomMoviesContainer = document.getElementById('random-movies');
      randomMoviesContainer.innerHTML = ''; // Clear previous random movies

      movies.forEach((movie, index) => {
        if (index < 10) { // Show only the first 10 random movies
          var posterUrl = movie.poster_path ? `https://image.tmdb.org/t/p/w342${movie.poster_path}` : 'placeholder.jpg';

          var movieElement = document.createElement('div');
          movieElement.classList.add('movie');

          // Wrap movie title and image inside an anchor tag
          var movieLink = document.createElement('a');
          movieLink.href = `movie_details.html?movieId=${movie.id}`; // Pass movie ID as a query parameter
          movieLink.innerHTML = `
            <div class="movie-details">
              <a href="movie_details.html?movieId=${movie.id}">
                <img src="${posterUrl}" alt="${movie.title} Poster" class="movie-poster">
              </a>
            </div>
          `;
          movieElement.appendChild(movieLink);

          // Create movie info elements
          var movieInfo = document.createElement('div');
          movieInfo.classList.add('movie-info');
          var movieTitle = document.createElement('h3');
          var titleLink = document.createElement('a'); // New anchor tag for movie title
          titleLink.href = `movie_details.html?movieId=${movie.id}`; // Pass movie ID as a query parameter
          titleLink.textContent = movie.title; // Set movie title text
          movieTitle.appendChild(titleLink); // Append title link to movie title element
          var releaseDate = document.createElement('p');
          releaseDate.textContent = `Release Date: ${movie.release_date}`;
          var rating = document.createElement('p');
          rating.textContent = `Rating: ${movie.vote_average}`;

          // Append movie info to movie details
          movieInfo.appendChild(movieTitle);
          movieInfo.appendChild(releaseDate);
          movieInfo.appendChild(rating);

          // Append movie info to movie element
          movieElement.appendChild(movieInfo);

          // Append movie element to random movies container
          randomMoviesContainer.appendChild(movieElement);
        }
      });
    }

    // Search movies by genre
    function searchMoviesByGenre(genreName) {
      var genreMap = JSON.parse(localStorage.getItem('genreMap'));
      var genreId = genreMap[genreName.toLowerCase()];
      if (!genreId) {
        console.error('Genre not found:', genreName);
        return;
      }

      var apiKey = 'd5697eb16a89b204a004af1f8fea130c';
      var apiUrl = `https://api.themoviedb.org/3/discover/movie?api_key=${apiKey}&with_genres=${genreId}`;

      fetch(apiUrl)
        .then(response => response.json())
        .then(data => {
          if (data.results.length === 0) {
            displayNoResultsMessage();
          } else {
            displaySearchResults(data.results);
          }
        })
        .catch(error => {
          console.error('Error fetching data:', error);
        });
    }

    function searchMovies() {
      var searchType = document.getElementById('search-type').value;
      var searchQuery = document.getElementById('search').value;

      var apiKey = 'd5697eb16a89b204a004af1f8fea130c';

      var apiUrl = '';
      switch (searchType) {
        case 'title':
          apiUrl = `https://api.themoviedb.org/3/search/movie?api_key=${apiKey}&query=${searchQuery}`;
          break;
        case 'genre':
          searchMoviesByGenre(searchQuery);
          break;
        case 'year':
          apiUrl = `https://api.themoviedb.org/3/discover/movie?api_key=${apiKey}&primary_release_year=${searchQuery}`;
          break;
        // Add more cases for additional search options
        default:
          apiUrl = `https://api.themoviedb.org/3/search/movie?api_key=${apiKey}&query=${searchQuery}`;
      }

      fetch(apiUrl)
        .then(response => response.json())
        .then(data => {
          if (data.results.length === 0) {
            displayNoResultsMessage();
          } else {
            displaySearchResults(data.results);
          }
        })
        .catch(error => {
          console.error('Error fetching data:', error);
        });
    }

    function displaySearchResults(results) {
      var searchResultsContainer = document.getElementById('search-results');
      searchResultsContainer.innerHTML = ''; // Clear previous search results

      results.forEach((movie, index) => {
        if (index < 20) { // Show only the first 20 movies
          var posterUrl = movie.poster_path ? `https://image.tmdb.org/t/p/w342${movie.poster_path}` : 'placeholder.jpg';

          var movieElement = document.createElement('div');
          movieElement.classList.add('movie');

          // Wrap movie title and image inside an anchor tag
          var movieLink = document.createElement('a');
          movieLink.href = `movie_details.html?movieId=${movie.id}`; // Pass movie ID as a query parameter
          movieLink.innerHTML = `
            <div class="movie-details">
              <a href="movie_details.html?movieId=${movie.id}">
                <img src="${posterUrl}" alt="${movie.title} Poster" class="movie-poster">
              </a>
            </div>
          `;
          movieElement.appendChild(movieLink);

          // Create movie info elements
          var movieInfo = document.createElement('div');
          movieInfo.classList.add('movie-info');
          var movieTitle = document.createElement('h3');
          var titleLink = document.createElement('a'); // New anchor tag for movie title
          titleLink.href = `movie_details.html?movieId=${movie.id}`; // Pass movie ID as a query parameter
          titleLink.textContent = movie.title; // Set movie title text
          movieTitle.appendChild(titleLink); // Append title link to movie title element
          var releaseDate = document.createElement('p');
          releaseDate.textContent = `Release Date: ${movie.release_date}`;
          var rating = document.createElement('p');
          rating.textContent = `Rating: ${movie.vote_average}`;

          // Append movie info to movie details
          movieInfo.appendChild(movieTitle);
          movieInfo.appendChild(releaseDate);
          movieInfo.appendChild(rating);

          // Append movie info to movie element
          movieElement.appendChild(movieInfo);

          // Append movie element to search results container
          searchResultsContainer.appendChild(movieElement);
        }
      });

      // Show "See more" button if there are more than 20 movies
      if (results.length > 20) {
        var seeMoreButton = document.createElement('button');
        seeMoreButton.textContent = 'See more';
        seeMoreButton.classList.add('see-more-button');
        seeMoreButton.addEventListener('click', function() {
          displayAdditionalResults(results);
        });
        searchResultsContainer.appendChild(seeMoreButton);
      }
    }

    function displayAdditionalResults(results) {
      var searchResultsContainer = document.getElementById('search-results');

      // Remove the "See more" button
      searchResultsContainer.removeChild(searchResultsContainer.lastChild);

      // Display additional results
      results.forEach((movie, index) => {
        if (index >= 20) { // Start from the 21st movie
          var posterUrl = movie.poster_path ? `https://image.tmdb.org/t/p/w342${movie.poster_path}` : 'placeholder.jpg';

          var movieElement = document.createElement('div');
          movieElement.classList.add('movie');
          movieElement.innerHTML = `
            <div class="movie-details">
              <img src="${posterUrl}" alt="${movie.title} Poster" class="movie-poster">
              <div class="movie-info">
                <h3>${movie.title}</h3>
                <p>Release Date: ${movie.release_date}</p>
                <p>Rating: ${movie.vote_average}</p>
                <!-- Add more movie details as needed -->
              </div>
            </div>
          `;
          searchResultsContainer.appendChild(movieElement);
        }
      });
    }

    function displayNoResultsMessage() {
      var searchResultsContainer = document.getElementById('search-results');
      searchResultsContainer.innerHTML = '<p>No movies were found.</p>';
    }

    // Call fetchGenreIds function when the page loads
    fetchGenreIds();

    // Fetch random movies when the page loads
    fetchRandomMovies();
  </script>
</body>
</html>
