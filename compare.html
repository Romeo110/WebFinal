<!DOCTYPE html>
<html lang="en">

<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <link href='https://unpkg.com/boxicons@2.1.4/css/boxicons.min.css' rel='stylesheet'>
    <script src="https://kit.fontawesome.com/46b7ceee20.js" crossorigin="anonymous"></script>
    <title>FilmFinder - Compare</title>
    <link rel="stylesheet" href="css/compare.css">
</head>

<body>
    <!-- horizontal navbar -->
    <div class="navbar">
        <div class="horizontal-navbar">
            <ul>
                <li>
                    <a href="index.html" class="nav-link">
                        <span class="item-icon">
                        <i class='bx bxs-home'></i>
                    </span>
                        <span class="item-txt">
                        Home
                    </span>
                    </a>
                </li>
                <li>
                    <a href="movies.html" class="nav-link">
                        <span class="item-icon">
                        <i class='bx bx-movie'></i>
                    </span>
                        <span class="item-txt">
                        Movies
                    </span>
                    </a>
                </li>
                <li>
                    <a href="compare.html" class="nav-link">
                        <span class="item-icon">
                        <i class='bx bxl-deezer'></i>
                      </span>
                        <span class="item-txt">
                        Compare
                      </span>
                    </a>
                </li>
                <li>
                    <a href="recommend.php" class="nav-link">
                        <span class="item-icon">
                        <i class='bx bxs-dish'></i>
                    </span>
                        <span class="item-txt">
                        MadeForYou
                    </span>
                    </a>
                </li>
                <li>
                    <a href="watch_list.php" class="nav-link">
                        <span class="item-icon">
                        <i class='bx bxs-user'></i>
                    </span>
                        <span class="item-txt">
                        WatchList
                    </span>
                    </a>
                </li>
                <li>
                    <a href="preferences.php" class="nav-link">
                        <span class="item-icon">
                        <i class='bx bx-cog'></i>
                    </span>
                        <span class="item-txt">
                        Preferences
                    </span>
                    </a>
                </li>
                <!-- Additional menu items if needed -->
            </ul>
        </div>
    </div>

    <div class="logo">
        <a href="index.html" class="nav-link logo-link">
            <span class="item-icon">
          <i class='bx bxs-film'></i>
      </span>
        </a>
    </div>

    <main>
        <div class="main-content">
            <div class="card">
                <div class="card-body">
                    <h2>What Is This Page?</h2>
                    <p class="intro-paragraph">
                        Welcome to FilmFinder's movie comparison tool! This handy feature allows you to compare two movies side by side, empowering you to make informed decisions about your next cinematic adventure. By analyzing essential details such as ratings, popularity,
                        and revenue, this tool provides valuable insights to help you pick the perfect flick for your next binge session. Leave the hard work to us as we crunch the numbers and present you with a personalized recommendation. With FilmFinder,
                        discovering your next favorite movie has never been easier. Sit back, relax, and let us guide you towards the perfect film for your viewing pleasure.</p>
                </div>
            </div>

            <div class="card">
                <div class="comparison-container" id="comparison-container">
                    <!-- Movie details will be added here dynamically -->
                </div>
            </div>

            <!-- Recommendation section -->
            <div class="card">
                <div class="recommendation" id="recommendation">
                    <h3>Our Recommendation</h3>
                    <p id="recommendation-text">Please select two movies for comparison.</p>
                </div>
            </div>
        </div>
    </main>

    <!-- Footer -->
    <footer class="footer">
        <div class="background">
            <svg version="1.1" xmlns="http://www.w3.org/2000/svg" xmlns:xlink="http://www.w3.org/1999/xlink" x="0px" y="0px" width="100%" height="100%" viewBox="0 0 1600 900">
              <defs>
                  <linearGradient id="bg" x2="0%" y2="100%">
                      <stop
                          offset="0%"
                          style="stop-color: #642b5b"
                      ></stop>
                      <stop
                          offset="100%"
                          style="stop-color: #fdf6fc"
                      ></stop>
                  </linearGradient>
                  <path
                      id="wave"
                      fill="url(#bg)"
                      d="M-363.852,502.589c0,0,236.988-41.997,505.475,0
          s371.981,38.998,575.971,0s293.985-39.278,505.474,5.859s493.475,48.368,716.963-4.995v560.106H-363.852V502.589z"
                  />
              </defs>
              <g>
                  <use xlink:href="#wave" opacity=".3">
                      <animateTransform
                          attributeName="transform"
                          attributeType="XML"
                          type="translate"
                          dur="8s"
                          calcMode="spline"
                          values="270 230; -334 180; 270 230"
                          keyTimes="0; .5; 1"
                          keySplines="0.42, 0, 0.58, 1.0;0.42, 0, 0.58, 1.0"
                          repeatCount="indefinite"
                      />
                  </use>
                  <use xlink:href="#wave" opacity=".6">
                      <animateTransform
                          attributeName="transform"
                          attributeType="XML"
                          type="translate"
                          dur="6s"
                          calcMode="spline"
                          values="-270 230;243 220;-270 230"
                          keyTimes="0; .6; 1"
                          keySplines="0.42, 0, 0.58, 1.0;0.42, 0, 0.58, 1.0"
                          repeatCount="indefinite"
                      />
                  </use>
                  <use xlink:href="#wave" opacty=".9">
                      <animateTransform
                          attributeName="transform"
                          attributeType="XML"
                          type="translate"
                          dur="4s"
                          calcMode="spline"
                          values="0 230;-140 200;0 230"
                          keyTimes="0; .4; 1"
                          keySplines="0.42, 0, 0.58, 1.0;0.42, 0, 0.58, 1.0"
                          repeatCount="indefinite"
                      />
                  </use>
              </g>
              <text x="50%" y="93%" dominant-baseline="middle" text-anchor="middle" fill="white" font-size="15">
                  &copy; 2024 FilmFinder. All rights reserved.
              </text>
          </svg>
        </div>
    </footer>
    <script>
        // Step 1: Retrieve movie IDs from local storage
        var movieIds = JSON.parse(localStorage.getItem('compare_movie_ids')) || [];
        var apiKey = 'd5697eb16a89b204a004af1f8fea130c';

        if (movieIds.length > 0) {
            // Step 2: Fetch movie details from TMDB API
            var movies = [];
            var promises = [];

            movieIds.forEach(function(movieId) {
                var movieUrl = `https://api.themoviedb.org/3/movie/${movieId}?api_key=${apiKey}`;
                promises.push(fetch(movieUrl).then(response => response.json()));
            });

            Promise.all(promises).then(function(responses) {
                responses.forEach(function(movieData) {
                    if (movieData) {
                        movies.push(movieData);
                    }
                });

                // Step 3: Compare the movies based on rating, popularity, revenue, etc.
                var recommendation = '';
                if (movies.length >= 2) {
                    // Compare each criterion separately
                    var ratingDiff = movies[0].vote_average - movies[1].vote_average;
                    var popularityDiff = movies[0].popularity - movies[1].popularity;
                    var revenueDiff = movies[0].revenue - movies[1].revenue;

                    var betterCriteriaCount = 0;

                    if (ratingDiff > 0) betterCriteriaCount++;
                    if (popularityDiff > 0) betterCriteriaCount++;
                    if (revenueDiff > 0) betterCriteriaCount++;

                    if (betterCriteriaCount >= 2) {
                        recommendation = 'We recommend ' + movies[0].title + ' based on achieving at least two out of three criteria: rating, popularity, and revenue.';
                    } else {
                        recommendation = 'We recommend ' + movies[1].title + ' based on achieving at least two out of three criteria: rating, popularity, and revenue.';
                    }
                } else {
                    recommendation = 'Please select two or more movies for comparison.';
                }

                // Step 4: Display movie details dynamically
                var comparisonContainer = document.getElementById('comparison-container');
                comparisonContainer.innerHTML = '';

                movies.forEach(function(movie) {
                    var movieContainer = document.createElement('div');
                    movieContainer.classList.add('movie-container');

                    var image = document.createElement('img');
                    image.src = `https://image.tmdb.org/t/p/w342/${movie.poster_path}`;
                    image.alt = movie.title;

                    var title = document.createElement('h2');
                    title.textContent = movie.title;

                    var rating = document.createElement('p');
                    rating.textContent = 'Rating: ' + movie.vote_average;

                    var popularity = document.createElement('p');
                    popularity.textContent = 'Popularity: ' + movie.popularity;

                    var revenue = document.createElement('p');
                    revenue.textContent = 'Revenue: $' + movie.revenue.toLocaleString();

                    var removeBtn = document.createElement('button');
                    removeBtn.classList.add('remove-btn');
                    removeBtn.dataset.movieId = movie.id;
                    removeBtn.textContent = 'Remove from Compare';

                    removeBtn.addEventListener('click', function() {
                        // Remove the movie ID from the compare list in local storage
                        var index = movieIds.indexOf(movie.id.toString());
                        if (index !== -1) {
                            movieIds.splice(index, 1);
                            localStorage.setItem('compare_movie_ids', JSON.stringify(movieIds));
                            // Remove the movie container from the comparison page
                            movieContainer.remove();
                            // Update the recommendation if there are less than two movies
                            if (movieIds.length < 2) {
                                document.getElementById('recommendation-text').textContent = 'Please select two movies for comparison.';
                            }
                        }
                    });

                    movieContainer.appendChild(image);
                    movieContainer.appendChild(title);
                    movieContainer.appendChild(rating);
                    movieContainer.appendChild(popularity);
                    movieContainer.appendChild(revenue);
                    movieContainer.appendChild(removeBtn);

                    comparisonContainer.appendChild(movieContainer);
                });

                // Step 5: Display the recommendation
                document.getElementById('recommendation-text').textContent = recommendation;
            });
        } else {
            // Display message if there are no movies in the comparison list
            document.getElementById('recommendation-text').textContent = 'Please select two movies for comparison.';
        }

        // footer swap
        window.addEventListener('scroll', function() {
            var scrollPosition = window.scrollY;
            var windowHeight = window.innerHeight;
            var documentHeight = document.documentElement.scrollHeight;
            var threshold = 30;

            // Check if the scrollbar is at the bottom of the page
            if (scrollPosition + windowHeight >= documentHeight - threshold) {
                // Show animated footer
                document.body.classList.add('show-footer');
            } else {
                // Hide animated footer
                document.body.classList.remove('show-footer');
            }
        });
    </script>
</body>

</html>