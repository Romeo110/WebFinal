<!DOCTYPE html>
<html lang="en">
<head>
  <meta charset="UTF-8">
  <meta name="viewport" content="width=device-width, initial-scale=1.0">
  <title>FilmFinder - Compare</title>
  <link rel="stylesheet" href="styles.css"> <!-- Include your CSS file here -->
</head>
<body>
  <header>
    <h1>FilmFinder</h1>
    <nav>
      <ul>
        <li><a href="index.html">Home</a></li>
        <li><a href="compare.html">Comparison</a></li>
        <li><a href="recommend.html">Recommendations</a></li>
        <li><a href="movies.html">Movies</a></li>
        <li><a href="#">Profile</a></li>
      </ul>
    </nav>
  </header>

  <main>
    <div class="comparison-container" id="comparison-container">
      <!-- Movie details will be added here dynamically -->
    </div>

    <!-- Recommendation section -->
    <div class="recommendation" id="recommendation">
      <h3>Recommendation:</h3>
      <p id="recommendation-text">Please select two movies for comparison.</p>
    </div>
  </main>

  <footer>
    <p>&copy; 2024 FilmFinder. All rights reserved.</p>
  </footer>

  <script>
    // Step 1: Retrieve movie IDs from local storage
    var movieIds = JSON.parse(localStorage.getItem('movieIds'));
    var apiKey = 'd5697eb16a89b204a004af1f8fea130c';

    if (movieIds && movieIds.length === 2) {
      // Step 2: Fetch movie details from TMDB API
      var movies = [];
      var promises = [];

      movieIds.forEach(function(movieId) {
        var movieUrl = `https://api.themoviedb.org/3/movie/${movieId}?api_key=${apiKey}`;
        promises.push(fetch(movieUrl).then(response => response.json()));
      });

      Promise.all(promises).then(function(responses) {
        responses.forEach(function(movieData) {
          if (movieData) {
            movies.push(movieData);
          }
        });

        // Step 3: Compare the movies based on rating, popularity, revenue, etc.
        var recommendation = '';
        if (movies.length === 2) {
          if (movies[0].vote_average > movies[1].vote_average) {
            recommendation = movies[0].title;
          } else {
            recommendation = movies[1].title;
          }
        } else {
          recommendation = 'Please select two movies for comparison.';
        }

        // Step 4: Display movie details dynamically
        var comparisonContainer = document.getElementById('comparison-container');
        comparisonContainer.innerHTML = '';

        movies.forEach(function(movie) {
          var movieContainer = document.createElement('div');
          movieContainer.classList.add('movie-container');

          var image = document.createElement('img');
          image.src = `https://image.tmdb.org/t/p/w342/${movie.poster_path}`;
          image.alt = movie.title;

          var title = document.createElement('h2');
          title.textContent = movie.title;

          var rating = document.createElement('p');
          rating.textContent = 'Rating: ' + movie.vote_average;

          var popularity = document.createElement('p');
          popularity.textContent = 'Popularity: ' + movie.popularity;

          var revenue = document.createElement('p');
          revenue.textContent = 'Revenue: $' + movie.revenue.toLocaleString();

          var removeBtn = document.createElement('button');
          removeBtn.classList.add('remove-btn');
          removeBtn.dataset.movieId = movie.id;
          removeBtn.textContent = 'Remove from Compare';

          movieContainer.appendChild(image);
          movieContainer.appendChild(title);
          movieContainer.appendChild(rating);
          movieContainer.appendChild(popularity);
          movieContainer.appendChild(revenue);
          movieContainer.appendChild(removeBtn);

          comparisonContainer.appendChild(movieContainer);
        });

        // Step 5: Display the recommendation
        document.getElementById('recommendation-text').textContent = recommendation;
      });
    }
  </script>
</body>
</html>
